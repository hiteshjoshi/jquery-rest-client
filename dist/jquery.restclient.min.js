!function(t){t.RestClient=function(e,r){"object"==typeof e?r={api:e}:"object"==typeof r?r.api=e:r={api:e};var i="jQuery-Rest-Client",n=t.extend({waitingTime:300,waitLoopLimit:60,logger:0,fnError:function(t){},setup:{cache:!1,dataType:"json",headers:{}}},r||{}),h=function(t){n.logger<=1&&console.log(i+": "+t)},s=function(t){n.logger<=2&&console.error(i+": "+t)},u=function(t){s(t),n.fnError(t)},c={},a=null,o=0,d=function(e,r){var i=e.parent>-1&&e.waiting?e.waiting:a;if(!i||c[i]){var s=t.extend({method:e.current.method,url:n.api+"/"+e.url+e.current.path,success:r||null,cache:n.cache,headers:e.current.headers},n.setup||{});return"POST"==e.current.method?s.data=e.current.data:"GET"==e.current.method&&(s.data=t.extend(e.current.query||{},e.current.data||{})),t.ajax(s)}if(h("Trying... "+e.key),!(e.waitingCount<n.waitLoopLimit))return u("Wait too long, canceled operation. ["+e.key+":"+e.section+"]");var o=function(){++e.waitingCount,d(e,r)};setTimeout(o,n.waitingTime)},l=function(e,r){return this.waitingCount=0,this.section=e,this.url=r,this.parent=-1,this.waiting=null,this.key=o++,this.current=this.currentClean={method:null,query:null,data:null,path:"",headers:{}},this.childrens=[],this.wait=function(t){return c[t]===!0?this:(c[t]=!1,this.parent>-1?(h("WAIT REGISTRY IN PARENT: "+t+" by "+this.key),this.waiting=t):(h("WAIT REGISTRY WHIOUT PARENT: "+t+" by "+this.key),a=t),this)},this.release=function(t){return c[t]=!0,h("WAIT UNREGISTRED: "+t+" by "+this.key),this},this.setApi=function(t){return n.api=r=t,this},this.add=function(t,e){if("object"!=typeof t){this.childrens.push(t);var r=e||t;this.url&&(r=this.url+"/"+r),this[t]=new l(t,r),this[t].parent=this.key}else for(var i in t)this.add(i,t[i])},this.query=function(t,e){return"object"==typeof t?this.current.query=t:(this.current.query={},this.current.query[t]=e),this.current.method||(this.current.method="GET"),this},this.data=function(t,e){return"object"==typeof t?this.current.data=t:(this.current.data={},this.current.data[t]=e),this.current.method||(this.current.method="POST"),this},this.defaultHeaders=function(e){return n.setup.headers=t.extend(n.setup.headers,e||{}),this},this.headers=function(e){return this.current.headers=t.extend(this.current.headers,e||{}),this},this.method=function(t){return this.current.method=t,this},this.isPost=function(){return this.current.method="POST",this},this.isGet=function(){return this.current.method="GET",this},this.isPut=function(){return this.current.method="PUT",this},this.isDelete=function(){return this.current.method="DELETE",this},this.token=function(t){this.defaultHeaders({Authorization:"Bearer "+t})},this.clear=function(t){t?current=currentClean:(this.current.query=null,this.current.data=null,this.current.method=null,this.current.path="")},this.error=function(t){n.fnError=t},this.read=function(t){return this.clear(),"object"==typeof t?(this.current.query=t,this.current.path=""):this.current.path="/"+t,this.current.method="GET",this},this.create=function(t){return this.clear(),this.current.data=t,this.current.method="POST",this},this.update=function(t){return this.clear(),this.current.data=t,this.current.method="PUT",this},this.delete=function(t){return this.clear(),this.current.path="/"+t,this.current.method="DELETE",this},this.custom=function(t){return this.current={method:t.method||null,query:t.query||null,data:t.query||null,path:t.path||"",headers:t.headers||{}},this},this.get=this.read,this.post=this.create,this.put=this.update,this.insert=this.create,this.del=this.delete,this.remove=this.delete,this.destroy=this.delete,this.then=function(t){return h("Run the "+this.key),d(this,t)},this.exec=function(t){return h("Run the "+this.key),d(this)},this};return l(n.api)}}(jQuery);